using FluentResults;
using IataMessageProcessor.Formatters.TextMessages;
using IataMessageProcessor.Parsers.TextMessages;
using IataMessageStandard;
using Xunit;


namespace IataMessageProcessorFacts
{
    public class Fsa15Facts
    {
        private TextMessageParser parser;
        private TextMessageFormatter formatter;

        public Fsa15Facts()
        {
            parser = new TextMessageParser();
            formatter = new TextMessageFormatter();
        }

        [Fact]
        public void ParserAndFormat()
        {
            string fsa15OriginText = @"FSA/15
157-72071554PENSVO/T10K4044.0
RCS/02JAN1403/ALA/T6K150/UTEGENOV SERIK
/MC2.96
RCS/02JAN1659/SVO/T1K0.2
RCS/13MAY1017/BKK/T809K5095.0/NA
RCT/MI/23MAR1813/HKT/T148K1645.2
/SU/AERODAR
RCT/RU/30OCT1014/SIN/T10K263
/SU
RCT/RU/17OCT2034/ORD/T1K12.2
RCF/SU2428/03MAY0015-N/BLQ/T2600K22057
RCF/SU270/04NOV2002/BKK/T4K29.0//A2000
RCF/RU791/04OCT0600-N/NRT/P137K2441.5/A0515/A2015
RCF/N4201/05NOV0519/PEE/T3K37
RCF/SU8989/16APR2346/CPH/T149K3495//S2330
BKD/RU8105/09AUG/FRAVIE/T1151K10006/S2359/S0800-S/MC127.84
BKD/SU270/15SEP/SVOBKK/T8K66.0/A0900/E2220
BKD/P35070/21SEP/AMSOVB/T19K7435/E1000-N/E0003-S/MC1.00
BKD/TX9806/09NOV/BKKSVO/T1460K26274///MC10.00
BKD/TX9806/09NOV/BKKSVO/T1460K26274//E0003/MC10.00
BKD/TX9806/09NOV/BKKSVO/T1460K26274
MAN/KC875/18MAR/ALADME/T11K110.4/S1855-P/S2350
MAN/SU2131/19FEB/ISTPEK/T5/S1456/S1726
MAN/RU7771B/12OCT/LHRAMS/T9K1390
MAN/SU2982/25SEP/LEDVVO/T1K23/S1715
DEP/SU2137/30APR/ISTROV/T2//E0230
DEP/SU001/05MAY/OSLHEL/T140K3370/A0940/S1000-N
DEP/SU2137/11MAY/ISTKUF/T8/A1529/E1759
DEP/HZ5616/13MAY/VVOPKC/T138K944
DEP/SU001/18AUG/OSLHEL/T81K1846/A1100/S0600-N
DEP/RU339/13OCT/SINHKG/T48K454/A0415-N/A0745-N
DEP/RU2065/01OCT/SEAORD/T11K923/A2200/A0800-T
PRE/RU6227/28OCT/CDGFRA/T1K5/S2010/E2000
PRE/RU560/30OCT/LGGDME/T1K38/E0230-N/E0620-N
TRM/AF/CPH/T6K166
TRM/AF/CPH/T3K25.5
TFD/SU/12DEC1713/GVA/P100K1008/768347
TFD/SU/21JAN1713/BKK/T33K349.0/045491
/SU
TFD/SU/05AUG1713/BKK/T83K1339.0/042019
/SU/AFL-LOGISTIC
NFD/03JUN0942/JFK/T44
NFD/02MAR1713/IAD/T1K28/OLD DOMINION FREIGHT LINE INC.
AWD/05MAY1926/KUF/T1K2/GADZHIEV AI
CCD/30JAN1739/MIA/T136K1600
CCD/21JAN1950/MIA/T1
ULD/PMC16735QR/PMC91281FF/PMC15825QR
DLV/04MAR2142/ALA/T1K4
DLV/05MAR1950/KHV/T12K127/POLOVKOV N.V.
DIS/SU1602/27MAR1950/KUF/DFLD/T4K15.2
ULD/PAG77151SU/PAG77091SU/AKE37670SU/AKE35949SU/PAG69290SU
DIS/SU502/27MAR1927/TLV/FDCA/P4K862.9
DIS//26MAR0911/ARN/FDCA/T1K0.7
OSI/VIOLATION OF PACKAGING
CRC/26MAR0911/SVO/T45///LGGDME
DDL/05MAR0911/KHV/T12K127/POLOVKOV N.V.
OSI/VIOLATION OF PACKAGING
TGC/21JAN1950/MIA/T1
ULD/PMC16735QR/PMC91281FF/PMC15825QR
ARR//28MAY2050-P/PEE/T1/A0000/A2050
ARR/SU010/29SEP0933/LED/P4K54//A0933
ARR/HZ5629/01JAN1909/KHV/T1/A0000/A1909
ARR/SU1421/01JAN1334/SVO/T1K1.2
AWR/SU2040/29JUL1235/ZAG/T8//A1210
AWR/SU2034/17DEC1413-T/OTP/T2//A1205
AWR/FV6527/22DEC1257/SOF/T150K2011.0
AWR/SU044/20OCT0003/LED/T1K17/A1205/A0003-N
FOH/04JUN1601/LED/T42K119.605/FGUP POCHTA ROSSII
/MC0.031
FOH/05MAR2038/MAD/T1K276/KUEHNE  NAGEL S.A.
OCI/IE/OSS/RC/QADOH-QR
/MY/ISS/RA/00001-01
/MY//SS/SPX
/MY//SS/SPX
/MY//SM/XRY
/MY//SM/XRY
/MY//SN/NIKARIESANIKHARIS
/MY//SN/NORHAILIZAMOHD RADZI
/MY//SD/01-DEC-2021 2047
/MY//SD/02-DEC-2021 1507
/MY//ED/0522
";
            Result<object> rObject = parser.Parse(fsa15OriginText);
            Fsa15 fsa15 = rObject.ValueOrDefault as Fsa15;

            Assert.NotNull(fsa15);
            Assert.Empty(rObject.Errors);

            string fsa15TextActual = formatter.ToString(fsa15);

            Assert.Equal(fsa15OriginText, fsa15TextActual);
        }
    }
}
