using FluentResults;
using IataMessageProcessor.Formatters.TextMessages;
using IataMessageProcessor.Parsers.TextMessages;
using IataMessageStandard;
using Xunit;


namespace IataMessageProcessorFacts
{
    public class Fbl4Facts
    {
        private TextMessageParser parser;
        private TextMessageFormatter formatter;

        public Fbl4Facts()
        {
            parser = new TextMessageParser();
            formatter = new TextMessageFormatter();
        }

        [Fact]
        public void ParseAndFormat()
        {
            string fbl4TextOrigin = @"FBL/4
1/KL775/09FEB/ZRH/HB-IHA
LIS/NIL
CCS
235-59889885SVOHKG/T12K25.9MC0.15/INTEGRATED CIRC
DIM/K0/CMT30-30-13/11
/K0/CMT44-26-17/1
/KVAZAR
555-51810426SVOIKA/T1K175MC0.12/RADIOACTIVE MAT
/470/GSP/471/RRY/PIL
/GSP DGP SU/E
SSR/SPECIALIZED DGR
/SSR3
OSI/ID 1437663181  HS 2844
/HALF-LIFE 8 DAYS  NO DELAY
555-20506555VVONBC/T10K194.4MC1.30/MASKI
ULD/2/PKC10056SU/K178.3/PKC12168SU/K89.1
555-27902932FRASVO/T1K3.8MC0.04/DATA LOADER  CI
/SVC
DIM/K0/CMT40-30-30/1
/LUFTHANSA TECHNIK/S
SSR/INVOICE ATTACHED TO AWB
/OWN
OSI/SPX KC DERA00777-05
OCI/DE/ISS/RA/00777-05
///ED/0521
///SN/BARBARA KLICH
///SD/06FEB210711
/DE/EXP/M/21DE330243450436E8
/DE/EXP/M/AT-ZLATE7100127002202133021
/DE/SHP/T/EUROPEAN VAT NUMBER DE811715450
/DE/SHP/CP/CUSTOMER SERVICE FRA
/DE/SHP/CT/496969647077
555-58195303ZAGMIA/T3K267.4MC2.88/CONSOLIDATION A
/460/CRT/EAP
DIM/K0/CMT120-80-100/3
/EURO-RUTA D.O.O./SU2041/12FEB/ZAG/X
ULD/2/PKC10056SU/K178.3/PKC12168SU/K89.1
SSR/3CLL MARKED AND ADDRESSED DOCUMENTS ATTACHED TO AWB TRANSPORT AN
/D STORAGE TEMPERATURE BETWEEN 15C AND 25C WHENEVER POSSIBLE EMERG
074-69123473ZRHCCS/T12K950DG9/BANKNOTES
/VAL
/ALFA AIR AGENCY/X
074-77184387ZRHMUN/P1K4DG4T12/SPARES
/EMERY
125-77184464ROMCCS/T123K12444MC94.4/CHEM LIQUID
/RFL
//SR917/07FEB/AMS/L
CUR
074-88241152ZRHCUR/T1K830MC1.2/MACHINERY
/HEA/MAG
OSI/CFM THAT SPECIAL TRUCK MUST BE USED TO
/MOVE THIS SHIPMENT
LIM
074-22221112ZRHLIM/T12K144DG4/MEDICINES
/PER
SSR/KEEP COOL STORE AT MINUS 2 DEGREES
/GENERAL
OCI///ST/DSV AIR SEA CO. LTD. CN1 HAS
/DE/EXP/M/20DE880426281976E0
/IT/SHP/T/EUROPEAN VAT NUMBERITIT00748210150
LAST
";
            Result<object> rObject = parser.Parse(fbl4TextOrigin);
            Assert.NotNull(rObject);
            var fbl4 = rObject.ToResult(o => (Fbl4)o);

            string fbl4TextActual = formatter.ToString(fbl4.Value);

            Assert.Equal(fbl4TextOrigin, fbl4TextActual);
        }
    }
}
